---
layout: post
title: Active-Active for Multi-Regional Resiliency By Netflix [번역]
subtitle: ''
categories: cs
tags: ds
comments: false
---

## 시작하기에 앞서

본 글은 [넷플릭스 기술 블로그](https://netflixtechblog.com)의 `Active-Active for Multi-Regional Resiliency` Article을 번역한 글입니다.

해당 Article의 저자는 `Ruslan Meshenberg, Naresh Gopalani, and Luke Kosewski`입니다.

## 서론

6월에 우리는 지역 전체 ELB 중단에 대한 `resiliency`(탄력성)를 위한 접근 방식인 [Isthmus](https://netflixtechblog.com/isthmus-resiliency-against-elb-outages-d9e0623484f3)에 대해 이야기 했었다.

`Isthmus` 프로젝트를 완료한 뒤, 우리는 더 높은 탄력성과 가용성을 위해 우리의 다음 과제에 착수했다. - 완전한 지역 전체 `Active-Active` 솔루션

이 프로젝트는 지금 완료하였고, 넷플릭스는 미국 전역에 `Active-Active`가 가동중이다. 

그래서 이 글은 몇 가지 흥미로운 도전 과제와 우리가 걸어간 길에 대한 배움을 강조하는 것을 목표로 한다.

## 실패 - 규모와 성능의 기능

일반적으로, 실패는 조직이 다루는 실패율은 크게 2가지, `변화의 속도와 운영 배포 규모`에 달려있다.

만약 규모와 속도가 작다면, 대부분의 경우 잘 동작한다.

규모가 커지면 속도가 느려도 하드웨어의 실패할 가능성이 높아진다.

반대로, 작은 규모라도 속도가 충분히 빠르다할지라도 소프트웨어의 실패할 가능성이 증가할 것이다.

궁극적으로, 당신이 큰 규모에서 동작하면서 여전히 빠른 속도를 추구한다면 작업은 항상 실패할 것이다.

물론, 모든 실패가 똑같이 생성되지는 않는다.

우리가 본 글에서 집중할 실패의 종류는 다루기 훨씬 더 어렵고 가장 중요한 것들이다.

완벽히 장기간 서비스가 멈춰서 불만을 품은 고객들의 글이 고객센터에 넘쳐나고, 그들의 불만이 트위터에 올라오고, "서비스 X가 다운됐다!"는 기사들이 여러 출판사에 나타나는 것들.

넷플릭스에서, 우리가 추구하는 가용성은 `99.99%`로 우리의 서비스가 중단될 시간이 많지 않다.

그래서 추가적으로 가용 가능한 지역과 여러 인스턴스들에 우리의 서비스를 배포하는 것에 더해, 우리는 여러 AWS 지역에 걸쳐 서비스를 배포해야하기로 결정했다.

완전한 지역 인프라 중단은 극단적으로 일어나지는 않지만, 우리의 변화는 속도는 때때로 지역에 있는 치명적인 서비스를 중단시키도 해서 우리는 넷플릭스가 어떤 숨은 의존들에도 탄력있는 서비스로 만들고 싶었다.

이 과정에서, 우리는 독립성 원칙과 이중화 활용하고 있다.

그것은 한 지역에서의 어떤 종류의 실패가 다른 동작중인 서비스에 영향을 미치지 않아야하며 `networking partitioning event`가 또 다른 지역의 서비스 품질에 영향을 미쳐서도 안된다.

## Active-Active 개요

쉽게 말해, `Active-Active` 솔루션이란 여러 AWS 지역에 걸쳐 배포된 유저 호출 경로의 모든 서비스를 가져오는 것이다.

이 경우에서는 버지니아의 `US-East-1`과 오레곤의 `US-West-2`이다.

이것을 하기 위해서, 몇 요구사항이 충족되어져야만한다.

- 서비스는 `stateless`해야만 한다. 모든 데이터와 상태의 복제는 데이터 계층에서 처리되어야한다.

- 그것들은 리전 내 로컬에서 어떤 자원에도 접근할 수 있어야한다. 이것은 S3, SQS 등과 같은 자원들을 포함한다. 이것은 S3 버킷으로 데이터를 발행하는 몇 애플리케이션들을 의미하며 그것들은 여러 지역에 걸친 S3에도 똑같은 데이터를 발행해야만한다.

- 유저의 호출 경로에 지역 간 호출이 되어서는 안된다. 데이터 복제는 비동기적이어야한다.

정상적인 동작에서, 유저는 50대 50으로 러프하게 분리된 가장 가까운 AWS 지역으로 라우팅되어질 것이다.

전 지역의 중대한 중단이 발생할 경우, 우리는 `geo-DNS`를 재정의하고, 모든 유저의 트래픽을 정상 지역으로 보내는 도구를 갖고 있다.

<img width="695" alt="스크린샷 2022-07-17 오후 9 44 07" src="https://user-images.githubusercontent.com/43809168/179398880-b36580b7-1080-4f8d-a838-34092d0eb9bf.png">

이러한 환경을 구축하기 위한 몇 가지 기술적 도전들이 있었다.

- 올바른 지역으로 트래픽을 보내기 위한 효과적인 도구들

- 엄청난 양의 이벤트를 다루기 위한 트래픽 조절과 부하 분산

- 상태와 데이터를 비동기적으로 여러 지역에 걸쳐 복제

## DNS - Denominator를 사용해 유저 트래픽 컨트롤

우리는 `UltraDNS`와 `Route 53`의 조합을 통해 유저의 트래픽을 우리의 서비스로 보낸다.

우리의 `Denominator` 프로젝트는 다양한 DNS 제공자를 다루는 커맨드라인과 단일 클라이언트 라이브러리를 제공한다.

왜 우리가 두개의 조합을 사용하게 된 몇 가지 이유가 있다.

- `UltraDNS`는 북미의 다른 지역에서 다른 지역 엔드포인트로부터 직접적으로 고객들을 라우팅하는 기능을 우리에게 제공한다. 이 기능은 `Dyn`을 포함한 다른 벤더에 의해 지원되지만 `Route 53`에서는 지원하지 않는다. 우리는 대기 시간 기반 라우팅 메커니즘을 사용하고 싶지 않았다. 왜냐하면 그것은 예측할 수 없는 `traffic migration effects`를 야기시키기 때문이다.

- `UtlraDNS`와 `ELB` 사이에 `Route 53` 레이러를 사용함으로써, 우리는 유저 트래픽을 전환하는 기능과 `Route 53` API가 다른 DNS 벤더 API들에서는 장점이 아닌 신뢰할 수 있고 빠른 구성 변경 기능을 제공한다.








